language: java
jdk:
  - openjdk10

services:
 - postgresql

addons:
  postgresql: "9.6"

env:
  - CONF_FILENAME=travis-config.yml NODE_VERSION=12.9

before_install:
 - psql -c 'create database travis_ci_test;' -U postgres
 - sudo sed -i 's/max_connections = 255/max_connections = 1000/g' /etc/postgresql/9.6/main/postgresql.conf
 - sudo service postgresql restart
 - nvm install $NODE_VERSION

install: true # Disable default install step. Maven runs install as part of the test life cycle anyway.

script: mvn test -B

deploy:
 - provider: heroku:api
   api_key: $HEROKU_API_KEY
   app: shopping-list--staging
   edge: true # opt in to dpl v2
